# -*- coding: utf-8 -*-
"""
Created on Sat Jan  9 21:04:22 2021

@author: likem
"""
import numpy as np

class EDR:
    # threshold of equivalence
    def __init__(self,xyDiff,timeDiff):
        self.xyDIFF = xyDiff
        self.timeDiff = timeDiff
    # two tuples
    def eq(self, c1, c2):
        return (abs(c1[0] - c2[0]) <= self.xyDIFF) and (abs(c1[1] - c2[1]) <= self.xyDIFF) \
            and (abs(c1[2]-c2[2]) <= self.timeDiff)
    
    ''' 递归求解EDR'''
    def EDR(self,S, R):
        if len(S) == 0:
            return len(R)
        if len(R) == 0:
            return len(S)
        subcost = 0 if self.eq(S[0], R[0]) else 1;
        a = self.EDR(R[1:], S[1:]) + subcost
        b = self.EDR(R[1:], S    ) + 1
        c = self.EDR(R    , S[1:]) + 1
        return min(a, b, c)
    
    ''' 动态规划求解 EDR'''
    def DP_EDR(self, S, R):
        ''' 创建动态规划矩阵'''
        row_nums = len(R)+1
        col_nums = len(S)+1
        # M = np.zeros((row_nums,col_nums))
        M = np.zeros((2,col_nums))
        M[1] = col_nums
        M[0,col_nums-1] = row_nums
        
        
        for row in range(row_nums-2,-1,-1):
            for col in range(col_nums-2,-1,-1):
                subcost = 0 if self.eq(R[row],S[col]) else 1
                # M[row,col] = min(M[row+1,col+1]+subcost, M[row,col+1]+1, M[row+1,col]+1)
                M[0,col] = min(M[1,col+1]+subcost, M[0,col+1]+1, M[1,col]+1)
            ''' 完成一行，置换M中的第二行为第一行，第一行为全0'''
            if row != 0:
                M[1,:] = M[0,:]
                M[0,:] = 0
                # print("{}-{}".format(row,col))
                # print(self.eq(R[row],S[col]))
                # print(M)
                # print("\n")
        return M[0,0]
        

'''test'''
if __name__ == "__main__":
    S1 = [(0,0,100), (1,3,150), (3,6,200)]
    S2 = [(0,0,300), (2,3,400), (4,6,500)]
    # S3 = [(0,0,300), (1,2,340), (2,4,500), (3,6,700)]
    # S4 = [(0,0,100), (1,1,200), (1,2,300), (2,3,500), (2,4,600), (3,5,650), (3,6,730)]
    xyDiff = 10
    timeDiff = 1000
    b1 = EDR(xyDiff,timeDiff)
    # print("S1-S2: ", b1.EDR(S1, S2))
    # print("S1-S3: ", b1.EDR(S1, S3))
    # print("S2-S3: ", b1.EDR(S2, S3))
    # print("S3-S4: ", b1.EDR(S3, S4)) 
    
    T1 = [[116.42008999999999, 39.96032, 441.0], [116.41283, 39.95265, 1410.0], [116.47835, 39.913959999999996, 4019.0], [116.47185, 39.90733, 4320.0], [116.45806999999999, 39.94815, 5701.0], [116.47018, 39.95265, 6225.0], [116.48226000000001, 39.97217, 6828.0], [116.46824, 39.94185, 7432.0], [116.46875, 39.93646, 8337.0], [116.46021, 39.95841, 8941.0], [116.48308999999999, 39.98877, 9544.0], [116.50894, 40.012640000000005, 35279.0], [116.4866, 40.00656, 35743.0], [116.4653, 40.00062, 37695.0], [116.45433, 39.98806, 38020.0], [116.43418999999999, 39.926559999999995, 40969.0], [116.43675, 39.93508, 41573.0], [116.43845, 39.93934, 42180.0], [116.42055, 39.904509999999995, 43377.0], [116.47273, 39.92695, 45164.0], [116.44698000000001, 39.922109999999996, 45767.0], [116.41618999999999, 39.92305, 46371.0], [116.39283999999999, 39.922, 46673.0], [116.37024, 39.908609999999996, 47276.0], [116.30365, 39.9046, 47880.0]]
    T2 = [[116.4226, 39.96092, 743.0], [116.4292, 39.88944, 2958.0], [116.47185, 39.90733, 4320.0], [116.49298999999999, 39.95841, 5144.0], [116.46586, 39.948479999999996, 5923.0], [116.48383999999999, 39.96839, 6526.0], [116.47873999999999, 39.95558, 7130.0], [116.46866000000001, 39.9364, 8035.0], [116.46841, 39.94123, 8639.0], [116.4777, 39.97484, 9242.0], [116.5157, 40.021679999999996, 9846.0], [116.48811, 40.00525, 35581.0], [116.486, 40.0067, 37393.0], [116.45575, 39.98833, 37997.0], [116.43233000000001, 39.98082, 38322.0], [116.43055, 39.93002, 41271.0], [116.44253, 39.9369, 41869.0], [116.42823999999999, 39.94085, 42482.0], [116.47623999999999, 39.926809999999996, 44890.0], [116.45629, 39.92198, 45466.0], [116.43348999999999, 39.922959999999996, 46069.0], [116.41618999999999, 39.92305, 46371.0], [116.37558, 39.91963, 46975.0], [116.33209, 39.90625, 47578.0], [116.30791, 39.91992, 48483.0]]
    # print("S3-S4: ", b1.EDR(T1, T2))
    
    M = b1.DP_EDR(T1,T2)
    